## PHP Wrappers

- Wrappers có thể truy cấp hoặc thực thi code thông qua giao thức PHP.

- Example:

  - `php://filter`: cho phép người dùng thay đổi dữ liệu cơ bản trước khi đọc hoặc ghi dữ liệu.
 
  - `php://filter/convert.base64-encode/resource=/etc/passwd`: encode base64 dữ liệu trước khi đọc

![image](https://github.com/user-attachments/assets/c06238c6-f126-4e40-ba2d-235decb621fe)

- Data Wrappers

- `data://`cho phép nhúng dữ liệu vào mã ứng dụng.

- Example:

  - `data:text/plain,<?php%20phpinfo();%20?>`
 
  - `data:mime-type,data`
 
## LFI2RCE-PHP Session Files

- Tệp phiên PHP cũng có thể được sử dụng trong một cuộc tấn công LFI , dẫn đến Thực thi mã từ xa, đặc biệt là nếu kẻ tấn công có thể thao túng dữ liệu phiên. Trong một ứng dụng web thông thường, dữ liệu phiên được lưu trữ trong các tệp trên máy chủ. Nếu kẻ tấn công có thể đưa mã độc vào các tệp phiên này và nếu ứng dụng bao gồm các tệp này thông qua lỗ hổng LFI , điều này có thể dẫn đến thực thi mã.

## LFI2RCE-Log Poisoning

- Là một kỹ thuật mà kẻ tấn công chèn mã thực thi vào tệp nhật ký của máy chủ web và sau đó sử dụng lỗ hổng LFI để bao gồm và thực thi tệp nhật ký này. Phương pháp này đặc biệt bí mật vì các tệp nhật ký được chia sẻ và là một phần dường như vô hại của các hoạt động máy chủ web. Trong một cuộc tấn công đầu độc nhật ký, trước tiên kẻ tấn công phải chèn mã PHP độc hại vào tệp nhật ký. Điều này có thể được thực hiện theo nhiều cách khác nhau, chẳng hạn như tạo ra một tác nhân người dùng độc hại, gửi một tải trọng qua URL bằng Netcat hoặc tiêu đề giới thiệu mà máy chủ ghi lại. Khi mã PHP nằm trong tệp nhật ký, kẻ tấn công có thể khai thác lỗ hổng LFI để bao gồm nó dưới dạng tệp PHP chuẩn . Điều này khiến máy chủ thực thi mã độc hại có trong tệp nhật ký, dẫn đến RCE .

## LFI2RCE-PHP Wrappers

- Các wrapper PHP cũng có thể được sử dụng không chỉ để đọc tệp mà còn để thực thi mã.  Điểm mấu chốt ở đây là php://filterwrapper luồng, cho phép chuyển đổi tệp ngay lập tức.  Lấy bộ lọc PHP base64 làm ví dụ. Phương pháp này cho phép kẻ tấn công thực thi mã tùy ý trên máy chủ bằng cách sử dụng tải trọng được mã hóa base64. 

- Example:

  - Sử dụng đoạn code php sau làm payload: `<?php system($_GET['cmd']); echo 'Shell done!'; ?>`
 
  - Giá trị payload sẽ như thế này: `php://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+`
