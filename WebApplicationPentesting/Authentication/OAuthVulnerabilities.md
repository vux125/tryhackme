# OAuth Vulnerabilities

- OAuth là một giao thức ủy quyền phổ biến giúp người dùng đăng nhập vào các dịch vụ mà không cần nhập lại mật khẩu.

## Các khái niệm

- Resource Owner: Chủ sở hữu tài nguyên là người hoặc hệ thống kiểm soát dữ liệu nhất định và có thể ủy quyền cho ứng dụng truy cập dữ liệu đó thay mặt họ.

- Client: Máy khách có thể là  ứng dụng di động  hoặc  ứng dụng web phía máy chủ .  Nó hoạt động như một trung gian, yêu cầu truy cập vào tài nguyên và thực hiện các hành động theo sự cho phép của chủ sở hữu tài nguyên.

- Authorization Server: Máy chủ ủy quyền chịu trách nhiệm cấp mã thông báo truy cập cho máy khách sau khi xác thực thành công chủ sở hữu tài nguyên và nhận được ủy quyền của họ. Máy chủ ủy quyền đóng vai trò quan trọng trong quy trình OAuth bằng cách đảm bảo máy khách chỉ được cấp quyền sau khi xác thực và đồng ý hợp lệ của người dùng.

- Resource Server: Máy chủ lưu trữ các tài nguyên được bảo vệ có thể  chấp nhận và phản hồi  các yêu cầu về tài nguyên được bảo vệ bằng cách sử dụng mã thông báo truy cập. Máy chủ này đảm bảo rằng chỉ những máy khách được xác thực và ủy quyền mới có thể truy cập hoặc thao tác dữ liệu của chủ sở hữu tài nguyên.

- Authorization Grant: Máy khách sử dụng thông tin xác thực đại diện cho quyền của chủ sở hữu tài nguyên (để truy cập vào tài nguyên được bảo vệ của họ) để lấy mã thông báo truy cập. Các loại cấp quyền chính là  `Authorization Code`,  `Implicit`,  `Resource Owner Password Credentials`, và  `Client Credentials`.

- Access Token: Một thông tin xác thực mà khách hàng có thể sử dụng để truy cập vào các tài nguyên được bảo vệ thay mặt cho chủ sở hữu tài nguyên. Nó có tuổi thọ và phạm vi hạn chế. Mã thông báo truy cập rất cần thiết để duy trì giao tiếp an toàn và được bảo vệ giữa khách hàng và máy chủ tài nguyên mà không cần phải yêu cầu chủ sở hữu tài nguyên cung cấp thông tin xác thực nhiều lần.

- Refresh Token: Một thông tin xác thực mà khách hàng có thể sử dụng để có được mã thông báo truy cập mới mà không yêu cầu chủ sở hữu tài nguyên phải xác thực lại. Mã thông báo làm mới thường tồn tại lâu dài và cung cấp một cách để duy trì các phiên của người dùng mà không bị gián đoạn đăng nhập thường xuyên. 

- Redirect URI: URI mà máy chủ ủy quyền sẽ chuyển hướng tác nhân người dùng của chủ sở hữu tài nguyên sau khi cấp hoặc từ chối ủy quyền. Nó kiểm tra xem máy khách mà phản hồi ủy quyền đã được yêu cầu có đúng không. 

- Scope: Là cơ chế giới hạn quyền truy cập của ứng dụng vào tài khoản của người dùng. Chúng cho phép máy khách chỉ định mức truy cập cần thiết và máy chủ cấp phép thông báo cho người dùng mức truy cập nào mà ứng dụng đang yêu cầu. Phạm vi giúp thực thi `principle of least privilege`. 

- State Parameter: Một tham số tùy chọn duy trì trạng thái giữa máy khách và máy chủ ủy quyền. Nó có thể giúp ngăn chặn các cuộc tấn công CSRF bằng cách đảm bảo phản hồi khớp với yêu cầu của máy khách. Tham số state là một phần quan trọng trong việc bảo mật luồng OAuth.

- Token & Authorization Endpoint: Là nơi máy khách trao đổi quyền cấp phép (hoặc mã thông báo làm mới) để lấy mã thông báo truy cập. Ngược lại, điểm cuối ủy quyền là nơi chủ sở hữu tài nguyên được xác thực và ủy quyền cho máy khách truy cập vào các tài nguyên được bảo vệ.


## Các loại cấp quyền OAuth

- ***Authorization Code Grant*** là luồng OAuth 2.0 được sử dụng phổ biến nhất phù hợp với các ứng dụng phía máy chủ ( PHP , JAVA, .NET, v.v.). Trong luồng này, máy khách chuyển hướng người dùng đến máy chủ ủy quyền, nơi người dùng xác thực và cấp quyền . Sau đó, máy chủ ủy quyền chuyển hướng người dùng đến máy khách có mã ủy quyền . Máy khách trao đổi mã ủy quyền để lấy mã thông báo truy cập bằng cách yêu cầu điểm cuối mã thông báo của máy chủ ủy quyền.

![image](https://github.com/user-attachments/assets/5d07865c-2f99-46df-a6e8-a12dca3f0c94)

- Loại cấp phép này được biết đến với tính bảo mật nâng cao, vì mã ủy quyền được trao đổi để lấy mã thông báo truy cập từ máy chủ đến máy chủ, nghĩa là mã thông báo truy cập không bị lộ cho tác nhân người dùng (ví dụ: trình duyệt), do đó giảm nguy cơ rò rỉ mã thông báo. Nó cũng hỗ trợ sử dụng mã thông báo làm mới để duy trì quyền truy cập lâu dài mà không cần xác thực người dùng nhiều lần.

- ***Implicit Grant***

- ***Resource Owner Password Credentials Grant***

- ***Client Credentials Grant***
