# JWT(JSON WEB TOKEN)

## Cấu trúc

![image](https://github.com/user-attachments/assets/70cade76-ea59-4d6c-b14d-1b47f46b7e95)

- Gồm 3 phần chính:

  - Header: Tiêu đề thường chỉ ra loại mã thông báo, tức là JWT, cũng như thuật toán ký được sử dụng.

  - Payload: Payload là phần thân của token, chứa các yêu cầu. Yêu cầu là một phần thông tin được cung cấp cho một thực thể cụ thể. Trong JWT, có các yêu cầu đã đăng ký, là các yêu cầu được xác định trước theo tiêu chuẩn JWT và các yêu cầu công khai hoặc riêng tư. Các yêu cầu công khai và riêng tư là các yêu cầu do nhà phát triển xác định. Cần biết sự khác biệt giữa các yêu cầu công khai và riêng tư, nhưng không phải vì mục đích bảo mật
 
  - Signature: Chữ ký là phần của mã thông báo cung cấp phương pháp xác minh tính xác thực của mã thông báo. Chữ ký được tạo bằng cách sử dụng thuật toán được chỉ định trong tiêu đề của JWT.
 
- Thuật toán ký:

  - None: Không có chữ kỹ.
 
  - Symmetric Signing: Thuật toán ký đối xứng, chẳng hạn như HS265, tạo chữ ký bằng cách thêm giá trị bí mật vào tiêu đề và nội dung của JWT trước khi tạo giá trị băm. Việc xác minh chữ ký có thể được thực hiện bởi bất kỳ hệ thống nào có khóa bí mật.
 
  - Asymmetric Signing:  Thuật toán ký bất đối xứng, chẳng hạn như RS256, tạo chữ ký bằng cách sử dụng khóa riêng để ký tiêu đề và nội dung của JWT. Điều này được tạo bằng cách tạo băm và sau đó mã hóa băm bằng khóa riêng. Việc xác minh chữ ký có thể được thực hiện bởi bất kỳ hệ thống nào biết khóa công khai được liên kết với khóa riêng được sử dụng để tạo chữ ký.

## Sensitive Information Disclosure

- Lấy token từ câu lệnh: `curl -H 'Content-Type: application/json' -X POST -d '{ "username" : "user", "password" : "password1" }' http://10.10.177.249/api/v1.0/example1`

![image](https://github.com/user-attachments/assets/a39eb7ca-5562-42d6-bc6a-d161480e3fe3)

- Vào trang jwt.io để giả mã lấy cờ:

![image](https://github.com/user-attachments/assets/92518212-0542-4882-8d0e-6a7efb0440a3)

***THM{9cc039cc-d85f-45d1-ac3b-818c8383a560}***

## Signature Validation Mistakes (Lỗi xác thực chữ ký)

- Lỗi phổ biến thứ hai với JWT là không xác minh đúng chữ ký. Nếu chữ ký không được xác minh đúng, kẻ tấn công có thể làm giả mã thông báo JWT hợp lệ để truy cập vào tài khoản của người dùng khác.

**Example2**

- Lấy token:

![image](https://github.com/user-attachments/assets/62d1a944-7524-4a98-abef-bba7771b8ee6)

- Gửi yêu cầu kèm token vừa lấy được:

![image](https://github.com/user-attachments/assets/1d9ce60c-1328-4285-92f7-bb52a9349112)

- Gửi lại yêu cầu kèm token nhưng xóa đi thành phần thứ 3 (Chữ ký):

![image](https://github.com/user-attachments/assets/6fc3d0b2-f534-48f8-8e39-fb95fb50be07)

- Ta nhậ về cùng một kết quả như vậy là chữ ký đã không được xác minh.

- Sử dụng jwt.io để giải mã:

![image](https://github.com/user-attachments/assets/96fe4a14-d19d-4608-8ebb-038034001d7d)

- Thay đổi `"admin":0` thành `"admin":1` và gửi yêu cầu đi không cần chữ ký:

![image](https://github.com/user-attachments/assets/77547e04-cf0d-4a60-aded-d33e9f4bc125)

![image](https://github.com/user-attachments/assets/1981a0b9-8442-4753-bc07-bcee9241a39f)

***THM{6e32dca9-0d10-4156-a2d9-5e5c7000648a}***

**Example3**

- Lấy token:

![image](https://github.com/user-attachments/assets/7028a306-6055-4282-b8bb-3855e90efcbb)

- Dùng CyberChef để chuyển đổi phần header sang base64:

![image](https://github.com/user-attachments/assets/7df7d7c7-8f41-4b5b-b076-9e2787b1d4ff)

- Thay vào phần header:

![image](https://github.com/user-attachments/assets/543f7e58-688b-4b99-a0cd-158e6f7a4df0)

***THM{fb9341e4-5823-475f-ae50-4f9a1a4489ba}***

**Example4**

- Lấy token:

![image](https://github.com/user-attachments/assets/80f799c3-c51c-45cc-a4bb-b006812212da)

- Dùng hashcat để tìm ra khóa bí mật:

![image](https://github.com/user-attachments/assets/c2bf5997-3a1d-425b-b3c8-ee0680215334)

- Thay token vào:

![image](https://github.com/user-attachments/assets/f0e93a06-c4a3-40a4-9e1a-66062d86d7ad)

***THM{e1679fef-df56-41cc-85e9-af1e0e12981b}***

**Example5**

- Lấy public key và token:

![image](https://github.com/user-attachments/assets/755bef17-3441-43ff-b16e-0a81ee2cbc1c)

- Tạo file ja.py:

![image](https://github.com/user-attachments/assets/454e888c-df74-4a97-8345-b6066f7bdbb8)


- Tạo jwt với public key:

![image](https://github.com/user-attachments/assets/714fcccc-7bd9-41c2-a2d0-afa81a14b227)

