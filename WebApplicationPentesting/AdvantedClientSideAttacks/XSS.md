## 1. Causes and implications

- Causes:

  - Insufficient input validation and sanitization
 
  - Lack of output encoding
 
  - Improper use of security headers
 
  - Framework and language vulnerabilities
 
  - Third-party libraries

- Implications:

  - Session hijacking
 
  - Phishing and credential theft
 
  - Social engineering
 
  - Content manipulation and defacement
 
  - Data exfiltration
 
  - Malware installation
 
## 2. Reflected XSS

- Reflected XSS là một loại lỗ hổng XSS trong đó một tập lệnh độc hại được phản chiếu đến trình duyệt của người dùng, thường thông qua một URL được tạo sẵn hoặc gửi biểu mẫu

- Xem đoạn code php dưới đây:

<img width="440" height="108" alt="image" src="https://github.com/user-attachments/assets/98cbdbd6-f619-4880-88ad-2544adaa5953" />

  - Dữ liệu đầu vào không được valid và được ghi thẳng ra kẻ tấn công chỉ cần chèn q=<script>alert(document.cookie)</script> thì sẽ gây ra reflected xss.

  - Fix lỗ này cững khá đơn giản ta có thể encoding output bằng hàm htmlspecialchars() để chuyển đổi các ký tự như ***<, >, &. ", .*** được thay thế để ngăn các tập lệnh đầu vào.

  - Trong các ngôn ngữ như Python(Flask), JS(NodeJS), ASP.NET ... ta cũng có các hàm có thể thực hiện encoding như vậy. 

<img width="1241" height="450" alt="image" src="https://github.com/user-attachments/assets/0d7ce579-e479-4acb-8ac3-c2893c3a0bd2" />

## Vulnerable web application 1

- Khởi động và truy cập trang web kèm theo payload:

<img width="1241" height="270" alt="image" src="https://github.com/user-attachments/assets/23bb922d-9463-48b8-9cef-805c69e4c756" />

<img width="1255" height="249" alt="image" src="https://github.com/user-attachments/assets/45c9f8de-87d7-4be4-9be1-5797d204a1bc" />

## Stored XSS

- Stored XSS , hay Persistent XSS , là một lỗ hổng bảo mật ứng dụng web xảy ra khi ứng dụng lưu trữ dữ liệu đầu vào do người dùng cung cấp và sau đó nhúng vào các trang web được cung cấp cho người dùng khác mà không được xử lý hoặc thoát đúng cách.

- Có nhiều lý do khiến một ứng dụng web dễ bị tấn công bởi stored XSS . Một số biện pháp tốt nhất để ngăn chặn lỗ hổng stored XSS là:

  - Validate and sanitize input

  - Use output escaping

  - Apply context-specific encoding
 
  - Practice defence in depth

- Ví dụ mã dễ bị tấn công PHP:

<img width="693" height="230" alt="image" src="https://github.com/user-attachments/assets/fd0ca5c8-d151-4e0f-be94-7fb2a240dcc9" />

  - Chúng ta chỉ quan tâm đến lỗi XSS (bỏ qua SQL Injection), $comment được truyền thẳng vào câu truy vấn mà không có bước valid dữ liệu và khi echo ra cững không thực hiện mã hóa những ký tự đặc biệt điều này cực kỳ nguy hiểm.

- Để fix lỗi XSS này ta thực hiện mã hóa tất cả các ký tự đặc biệt bằng hàm htmlspecialchars() :

<img width="670" height="238" alt="image" src="https://github.com/user-attachments/assets/e842064d-05c9-4f5f-92f7-185eb2fb5ebc" />

<img width="1235" height="233" alt="image" src="https://github.com/user-attachments/assets/1ab2d092-3be0-4e92-8cd5-e49642e95a80" />

## Vunlnerable web application 2

- Gửi tin nhắn kèm đoạn payload js

<img width="1348" height="857" alt="image" src="https://github.com/user-attachments/assets/39b06295-ef1f-442b-a1e6-9bac5d29711a" />

- Khi ta đăng nhập vào admin thì sẽ có đoạn mã thông báo:

<img width="1274" height="798" alt="image" src="https://github.com/user-attachments/assets/e8875595-8929-4313-847d-7141af2ec3ea" />

- Sử dụng payloads <script>alert(document.cookie)</script>:

<img width="1273" height="783" alt="image" src="https://github.com/user-attachments/assets/0b903518-5d00-4ca2-80ac-dfeb36ab19fd" />


<img width="1253" height="261" alt="image" src="https://github.com/user-attachments/assets/9fcdf979-8533-41b4-9a7f-7302e609c2a1" />


## DOM-Based XSS

- DOM là một giao diện lập trình biểu diễn tài liệu web dưới dạng cây. DOM cho phép truy cập và thao tác theo chương trình các phần khác nhau của trang web bằng JavaScript.

- Ví dụ về một cây DOM:

<img width="389" height="449" alt="image" src="https://github.com/user-attachments/assets/f35ae39b-f827-4db1-a87d-197444603de7" />

- Ví dụ đoạn code sau:

<img width="712" height="317" alt="image" src="https://github.com/user-attachments/assets/6b2ff100-11b9-47a3-94ac-f1d6358bf2c8" />

- Trang web lấy tên người dùng trên url và hiển thị ra ***Hello, name***, 

<img width="1189" height="221" alt="image" src="https://github.com/user-attachments/assets/96f22591-9f6c-4350-a27b-614e53922698" />

- Người dùng hoàn toàn có thể chèn một đoạn mã độc hại vào name:

<img width="1226" height="369" alt="image" src="https://github.com/user-attachments/assets/1d450a51-7069-4333-a81a-0bd9b9a3e8cb" />

- Máy chủ không có vai trò trực tiếp trong các lỗ hổng dựa trên DOM. Trong phần trình diễn này, mọi thứ diễn ra trên trình duyệt của máy khách mà không cần sử dụng back-end.

- DOM đã bị sửa đổi không an toàn bằng cách sử dụng document.write()

- Để sửa lỗi này valid escape dữ liệu rồi mới hiển thị:

<img width="753" height="376" alt="image" src="https://github.com/user-attachments/assets/5bc7e1e2-306a-49ac-80fa-a0799463808d" />


<img width="1247" height="344" alt="image" src="https://github.com/user-attachments/assets/c64593cc-2482-4904-ab64-0919096173db" />
